!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./helpers"),t=require("./core"),n=require("./core");exports.applyOperation=n.applyOperation,exports.applyPatch=n.applyPatch,exports.applyReducer=n.applyReducer,exports.getValueByPointer=n.getValueByPointer,exports.validate=n.validate,exports.validator=n.validator;var o=require("./helpers");exports.JsonPatchError=o.PatchError,exports.deepClone=o._deepClone,exports.escapePathComponent=o.escapePathComponent,exports.unescapePathComponent=o.unescapePathComponent;var r=new WeakMap,a=function(){return function(e){this.observers=new Map,this.obj=e}}(),c=function(){return function(e,t){this.callback=e,this.observer=t}}();function u(e){var n=r.get(e.object);p(n.value,e.object,e.patches,""),e.patches.length&&t.applyPatch(n.value,e.patches);var o=e.patches;return o.length>0&&(e.patches=[],e.callback&&e.callback(o)),o}function p(t,n,o,r){if(n!==t){"function"==typeof n.toJSON&&(n=n.toJSON());for(var a=e._objectKeys(n),c=e._objectKeys(t),u=!1,s=c.length-1;s>=0;s--){var d=t[l=c[s]];if(!e.hasOwnProperty(n,l)||void 0===n[l]&&void 0!==d&&!1===Array.isArray(n))Array.isArray(t)===Array.isArray(n)?(o.push({op:"remove",path:r+"/"+e.escapePathComponent(l)}),u=!0):o.push({op:"replace",path:r,value:n});else{var i=n[l];"object"==typeof d&&null!=d&&"object"==typeof i&&null!=i?p(d,i,o,r+"/"+e.escapePathComponent(l)):d!==i&&o.push({op:"replace",path:r+"/"+e.escapePathComponent(l),value:e._deepClone(i)})}}if(u||a.length!=c.length)for(s=0;s<a.length;s++){var l=a[s];e.hasOwnProperty(t,l)||void 0===n[l]||o.push({op:"add",path:r+"/"+e.escapePathComponent(l),value:e._deepClone(n[l])})}}}exports.unobserve=function(e,t){t.unobserve()},exports.observe=function(t,n){var o,p,s=function(e){return r.get(e)}(t);if(s){var d=function(e,t){return e.observers.get(t)}(s,n);o=d&&d.observer}else s=new a(t),r.set(t,s);if(o)return o;if(o={},s.value=e._deepClone(t),n){o.callback=n,o.next=null;var i=function(){u(o)};p=function(){clearTimeout(o.next),o.next=setTimeout(i)},"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",p),window.addEventListener("keyup",p),window.addEventListener("mousedown",p),window.addEventListener("keydown",p),window.addEventListener("change",p)):(document.documentElement.attachEvent("onmouseup",p),document.documentElement.attachEvent("onkeyup",p),document.documentElement.attachEvent("onmousedown",p),document.documentElement.attachEvent("onkeydown",p),document.documentElement.attachEvent("onchange",p)))}return o.patches=[],o.object=t,o.unobserve=function(){u(o),clearTimeout(o.next),function(e,t){e.observers.delete(t.callback)}(s,o),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",p),window.removeEventListener("keyup",p),window.removeEventListener("mousedown",p),window.removeEventListener("keydown",p)):(document.documentElement.detachEvent("onmouseup",p),document.documentElement.detachEvent("onkeyup",p),document.documentElement.detachEvent("onmousedown",p),document.documentElement.detachEvent("onkeydown",p)))},s.observers.set(n,new c(n,o)),o},exports.generate=u,exports.compare=function(e,t){var n=[];return p(e,t,n,""),n}});
//# sourceMappingURL=fast-json-patch.min.js.map
