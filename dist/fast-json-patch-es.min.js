Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./helpers"),t=require("./core"),n=require("./core");exports.applyOperation=n.applyOperation,exports.applyPatch=n.applyPatch,exports.applyReducer=n.applyReducer,exports.getValueByPointer=n.getValueByPointer,exports.validate=n.validate,exports.validator=n.validator;var o=require("./helpers");exports.JsonPatchError=o.PatchError,exports.deepClone=o._deepClone,exports.escapePathComponent=o.escapePathComponent,exports.unescapePathComponent=o.unescapePathComponent;var r=new WeakMap,a=function(){return function(e){this.observers=new Map,this.obj=e}}(),p=function(){return function(e,t){this.callback=e,this.observer=t}}();function c(e){var n=r.get(e.object);u(n.value,e.object,e.patches,""),e.patches.length&&t.applyPatch(n.value,e.patches);var o=e.patches;return o.length>0&&(e.patches=[],e.callback&&e.callback(o)),o}function u(t,n,o,r){if(n!==t){"function"==typeof n.toJSON&&(n=n.toJSON());for(var a=e._objectKeys(n),p=e._objectKeys(t),c=!1,s=p.length-1;s>=0;s--){var d=t[l=p[s]];if(!e.hasOwnProperty(n,l)||void 0===n[l]&&void 0!==d&&!1===Array.isArray(n))Array.isArray(t)===Array.isArray(n)?(o.push({op:"remove",path:r+"/"+e.escapePathComponent(l)}),c=!0):o.push({op:"replace",path:r,value:n});else{var i=n[l];"object"==typeof d&&null!=d&&"object"==typeof i&&null!=i?u(d,i,o,r+"/"+e.escapePathComponent(l)):d!==i&&o.push({op:"replace",path:r+"/"+e.escapePathComponent(l),value:e._deepClone(i)})}}if(c||a.length!=p.length)for(s=0;s<a.length;s++){var l=a[s];e.hasOwnProperty(t,l)||void 0===n[l]||o.push({op:"add",path:r+"/"+e.escapePathComponent(l),value:e._deepClone(n[l])})}}}exports.unobserve=function(e,t){t.unobserve()},exports.observe=function(t,n){var o,u,s=function(e){return r.get(e)}(t);if(s){var d=function(e,t){return e.observers.get(t)}(s,n);o=d&&d.observer}else s=new a(t),r.set(t,s);if(o)return o;if(o={},s.value=e._deepClone(t),n){o.callback=n,o.next=null;var i=function(){c(o)};u=function(){clearTimeout(o.next),o.next=setTimeout(i)},"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",u),window.addEventListener("keyup",u),window.addEventListener("mousedown",u),window.addEventListener("keydown",u),window.addEventListener("change",u)):(document.documentElement.attachEvent("onmouseup",u),document.documentElement.attachEvent("onkeyup",u),document.documentElement.attachEvent("onmousedown",u),document.documentElement.attachEvent("onkeydown",u),document.documentElement.attachEvent("onchange",u)))}return o.patches=[],o.object=t,o.unobserve=function(){c(o),clearTimeout(o.next),function(e,t){e.observers.delete(t.callback)}(s,o),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",u),window.removeEventListener("keyup",u),window.removeEventListener("mousedown",u),window.removeEventListener("keydown",u)):(document.documentElement.detachEvent("onmouseup",u),document.documentElement.detachEvent("onkeyup",u),document.documentElement.detachEvent("onmousedown",u),document.documentElement.detachEvent("onkeydown",u)))},s.observers.set(n,new p(n,o)),o},exports.generate=c,exports.compare=function(e,t){var n=[];return u(e,t,n,""),n};
//# sourceMappingURL=fast-json-patch-es.min.js.map
